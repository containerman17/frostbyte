##########################################
# Production – EPYC 7502P (32 cores/256 GB)
# Aggressive, hands‑off compaction + ZSTD‑14
##########################################
[mysqld]
plugin-load-add = rocksdb=ha_rocksdb.so
default-storage-engine = rocksdb

# Disable binary logging to save space (adjust if you need replication)
skip-log-bin

# Parallelism – use ≈¾ of total cores for background + sub‑compactions
rocksdb_max_background_jobs        = 24
rocksdb_max_subcompactions         = 8

# Compression + CF options
rocksdb_default_cf_options = \
  compression=kZSTD;bottommost_compression=kZSTD;compression_opts=-14:4:0;bottommost_compression_opts=-14:4:0; \
  level_compaction_dynamic_level_bytes=true;optimize_filters_for_hits=true; \
  memtable_prefix_bloom_size_ratio=0.02;prefix_extractor=capped:12; \
  block_based_table_factory={cache_index_and_filter_blocks=1;filter_policy=bloomfilter:10:false;whole_key_filtering=0}; \
  level0_file_num_compaction_trigger=2;level0_slowdown_writes_trigger=12;level0_stop_writes_trigger=16; \
  max_write_buffer_number=8;max_bytes_for_level_base=4G;target_file_size_base=256M

rocksdb_override_cf_options = __system__={compression=kZSTD;bottommost_compression=kZSTD};default={compression=kZSTD;bottommost_compression=kZSTD}

rocksdb_compression_type            = kZSTD
rocksdb_bottommost_compression_type = kZSTD
rocksdb_compression_level           = 1
rocksdb_bottommost_compression_level= 1
rocksdb_compression_max_dict_bytes  = 65536
rocksdb_compression_zstd_max_train_bytes = 6553600

# Memory (≈128 GB for RocksDB, leaves >100 GB for OS)
rocksdb_block_cache_size = 64G
rocksdb_db_write_buffer_size = 64G

# WAL / I/O tuning
rocksdb_max_total_wal_size = 4G
rocksdb_wal_dir            = /var/lib/mysql
rocksdb_wal_compression    = kZSTD
rocksdb_bytes_per_sync     = 8M
rocksdb_wal_bytes_per_sync = 8M

# Periodic weekly compaction safety pass
rocksdb_periodic_compaction_seconds = 604800
rocksdb_compaction_pri = kMinOverlappingRatio
